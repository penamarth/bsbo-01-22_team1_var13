### **Рамки.** Приложение электронной доски объявлений.

### **Уровень.** Задача, определенная пользователем.

### **Основной исполнитель.** Зарегистрированный пользователь (покупатель).

### **Заинтересованные лица и их требования:**

- **Покупатель (зарегистрированный пользователь).** Хочет быстро и безопасно оплатить покупку товара, получив подтверждение об успешной транзакции и ожидаемой доставке.
- **Продавец (зарегистрированный пользователь).** Хочет получить уведомление о покупке и средства на свой счет после успешной транзакции.
- **Система платежей.** Хочет корректно обработать платеж, обеспечив безопасность транзакции.
- **Администратор.** Хочет гарантировать, что транзакции и обмен товарами происходят корректно и в соответствии с правилами платформы.
- **Компания.** Хочет генерировать доход от комиссии за успешные сделки и обеспечивать удовлетворенность пользователей.

### **Предусловия:**

- И покупатель, и продавец зарегистрированы и аутентифицированы в системе.
- Продавец уже разместил свое объявление с товаром, который доступен для покупки.

### **Результаты (Постусловия):**

- Покупатель успешно оплатил товар и получил подтверждение об оплате и доставке.
- Продавец получил уведомление о покупке и ожидает перевода средств.
- Платеж успешно обработан и зафиксирован.
- Система обновила соответствующие данные для учета и статистики.

### **Основной успешный сценарий:**

1. **Создание заказа:**
  - Покупатель нажимает кнопку "Оформить заказ" на странице просмотра корзины, **Board**

2. **Board** обращается к **Account** и получает текущий связанный **Delivery** со статусом не оплачено

3. Проход по массиву **Item** полученного объекта **Delivery** и считает суммарную стоимость заказа с учетом доставки и коммисии

4. деливери к адаптеру

5. адаптер к системе и возваращает пеймент

   

7. адаптер кудато там оплатил и вернул обект оплаты пеймент

8. пеймент обращается к аккаунт
   
2. **Перенаправление на систему платежей:**
  - Система вычисляет итоговую стоимость, вызывая метод `Payment::totalPrice()` включая возможные дополнительные сборы, такие как доставка и комиссия.
  - Система вызывает `Payment::redirect()` для перенаправления покупателя в систему платежей.

3. **Получение подтверждения и уведомление:**
  - Система получает подтверждение через метод `Payment::complete()` и уведомляет покупателя и продавца:
    - Покупатель получает уведомление об успешном платеже в результате вызова `notifyUser(buyer_id, message)`
    - Продавцу отправляется уведомление о том, что его товар был куплен в результате вызова `notifyUser(seller_id, message)`

4. **Передача заказа в обработку:**
  - После успешной покупки система передает сущность `Delivery` в службу обработки заказов
  - Оба пользователя могут использовать `Delivery::track() -> Status` для отслеживания доставки.

### **Расширения (альтернативные потоки):**

- **2а.** Покупатель хочет задать вопрос продавцу перед покупкой.
  1. **Покупатель** выбирает опцию "Задать вопрос".
  2. **Система** перенаправляет покупателя в чат с продавцом для уточнения деталей.
  3. **Покупатель** после получения ответа может вернуться к процессу покупки.

- **4а.** Покупатель имеет промокод или скидку.
  1. **Покупатель** вводит промокод.
  2. **Система** проверяет валидность промокода и пересчитывает стоимость покупки.
    - **2а1.** Промокод недействителен.
      1. **Система** уведомляет покупателя о недействительности промокода.
      2. **Покупатель** может ввести другой промокод или продолжить без него.

- **6а.** Покупатель выбирает оплату позже (если такая опция доступна).
  1. **Система** сохраняет заказ как неоплаченный.
  2. **Покупатель** может завершить покупку в течение ограниченного времени.

- **8а.** Платеж не прошел успешно.
  1. **Система платежей** уведомляет об ошибке платежа.
  2. **Система** информирует покупателя о неудачной попытке оплаты.
  3. **Покупатель** может попробовать снова или выбрать другой способ оплаты.

- **9а.** Связь с системой платежей потеряна.
  1. **Система** уведомляет покупателя о технической проблеме.
  2. **Покупатель** может повторить попытку позже.


- **10а.** Товар больше недоступен (например, был продан другому пользователю).
  1. **Система** уведомляет покупателя о том, что товар больше недоступен.
  2. **Покупатель** может выбрать другой товар или прекратить покупку.

### **Специальные требования:**

- Интерфейс должен быть интуитивно понятным и доступным для пользователей с разным уровнем технической подготовки.
- Система должна обеспечивать безопасность обработки персональных и платежных данных.
- Операция оплаты должна занимать не более 2 минут в 95% случаев.
- Возможность локализации интерфейса на разные языки.
- Поддержка различных способов оплаты (банковские карты, электронные кошельки и т.д.).

### **Список технологий и типов данных:**

- **6а.** Платежные данные вводятся через защищенное соединение (SSL/TLS).
- **Промокоды** хранятся в базе данных и имеют сроки действия и условия применения.
- **Платежные системы** интегрированы через API и поддерживают стандартные протоколы безопасности.

### **Частота использования:**

- Ожидается высокая частота использования, особенно в пиковые часы активности пользователей.

### **Открытые вопросы:**

- Какие дополнительные способы оплаты следует поддерживать?
- Требуется ли модерация покупателей для предотвращения мошенничества?
- Как обрабатывать случаи возврата средств при спорных ситуациях?
